<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Datatables in action .Server side processing</title>

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>

    <style>
        body {
            padding-top: 50px;
        }
    </style>
</head>

<body class="bg-info">

    <div class="container">
        <div class="jumbotron">
            <h2>Datatables in action!</h2>
        </div>
    </div>
    <div class="container">
        <div class="ZipDatatable">
            <table id="ZipcodesTable" class="table table-bordered table-sm">
                <thead>
                    <tr>

                        <th>ID</th>
                        <th>City</th>
                        <th>Population</th>
                        <th>State</th>
                        <th>State</th>

                    </tr>
                </thead>
                <tbody></tbody>
                <!-- <tfoot>
                    <tr>

                        <th>ID</th>
                        <th>City</th>
                        <th>Population</th>
                        <th>State</th>
                        <th>State</th>
                    </tr>
                </tfoot> -->
            </table>
        </div>
    </div>


</body>
<script>
    // $(document).ready(function() {
    //     var data = [{
    //         "name": "Tiger Nixon",
    //         "position": "System Architect",
    //         "salary": "$3,120",
    //         "start_date": "2011/04/25",

    //     }, {
    //         "name": "Garrett Winters",
    //         "position": "Director",
    //         "salary": "$5,300",
    //         "start_date": "2011/07/25",

    //     }];

    //     $('#ZipcodesTable').DataTable({
    //         "data": data,
    //         "columns": [ //列的標題一般是從DOM中讀取（也可以使用這個屬性為表格創建列標題)
    //             {
    //                 data: 'name',
    //                 title: "姓名"
    //             }, {
    //                 data: 'position',
    //                 title: "職位"
    //             }, {
    //                 data: 'salary',
    //                 title: "薪資"
    //             }, {
    //                 data: 'start_date',
    //                 title: "開始工作日"
    //             },
    //         ]
    //     })
    // });


    //$.fn.poshytip = { defaults: null };
    //$.fn.editable.defaults.mode = 'inline';
    $(document).ready(function() {
        var t = $('#ZipcodesTable').DataTable({
            "paging": true,
            "pageLength": 10,
            "processing": true,
            "serverSide": true,
            'ajax': {
                'type': 'POST',
                'url': '/populateZipCodes'
            },
            'columns': [{
                'data': '_id',
                'name': 'ID',
                // "defaultContent": ""
                'render': function(data, type, row) {
                    // console.log('data = ' + data);
                    return '<a href="#" target="_blank">' + data + '</a>' // 這邊是加連結
                }
            }, {
                'data': 'Action',
                "defaultContent": "",
                'name': 'City'
            }, {
                'data': 'Locale',
                "defaultContent": "",
                'name': 'Population'
            }, {
                'data': 'EPC',
                "defaultContent": "N",
                'name': 'State'
            }, {
                'data': '_id',
                'title': "操作功能", // 這邊是欄位
                'render': function(data, type, row) {
                        let str = `<button type="button" class="btn btn-warning btn-sm" onclick="editFunction('${data}')">編輯</button> ` +
                            `<button type="button" class="btn btn-danger btn-sm" onclick="delFunction('${data}')">刪除</button>`
                            // console.log('data = ' + data);
                        console.log(`str = ` + str);
                        return str;
                    }
                    // 'data': null,
                    // "defaultContent": "",
                    // 'title': '操作功能'
            }],
            "columnDefs": [{
                "searchable": false,
                "orderable": false,
                "targets": 0
            }]

        });

        /* t.on('draw', function () {
            //setting the next and prev buttons with active or disabled state

            //setting the index column with values.
            t.column(0, { search: 'applied', order: 'applied' }).nodes().each(
                function (cell, i) {
                    cell.innerHTML = i + 1;
                }
            );
            });
        */
        //paging
        /* $('#next').on('click', function () {
            t.page('next').draw('page');
            });

            $('#previous').on('click', function () {
                t.page('previous').draw('page');
            });
        */

        // $('#ZipcodesTable').DataTable();
    });

    function editFunction(val) {
        console.log('editfun data = ' + val);
        // document.getElementById("demo").style.color = "red";
    }

    function delFunction(val) {
        console.log('delfun data = ' + val);
        // document.getElementById("demo").style.color = "red";
    }
</script>

</html>